var fe=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var V=(n,e,t)=>e in n?fe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W=(n,e)=>{for(var t in e||(e={}))be.call(e,t)&&V(n,t,e[t]);if(te)for(var t of te(e))ke.call(e,t)&&V(n,t,e[t]);return n},F=(n,e)=>me(n,ge(e));var l=(n,e,t)=>(V(n,typeof e!="symbol"?e+"":e,t),t);import{d as I,C as _,D as b,E as v,F as d,G as c,H as p,I as Q,J as U,L as w,a as L,u as ye,M as S,N as _e,O as R,P as ve,Q as we,A as Be}from"./vendor-@vue.240efece.js";import{Q as J,a as ne,b as Te,c as Ie,d as Se,e as M,f as Ce,g as Pe,h as j,i as oe,j as Ge,k as $e,l as Ne,m as Le,n as Re,o as re,p as Oe,q as Ee}from"./vendor-quasar.c553bed0.js";import{c as f,a as Ae,i as De}from"./vendor.c828cf64.js";/* empty css                       */import{c as He,a as qe}from"./vendor-vue.2efd0231.js";const Ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}};Ve();var C=(n,e)=>{const t=n.__vccOpts||n;for(const[o,r]of e)t[o]=r;return t};const We=I({name:"Home",inject:["keycloak"],data:function(){return{error:null}},mounted:function(){},destroyed:function(){},methods:{setup(){}}}),Fe={key:0},Qe=d("h1",null,"Not authenticated",-1),Ue={key:1};function Je(n,e,t,o,r,a){const i=_("TournamentList");return b(),v("div",null,[n.$keycloak==null||!n.$keycloak.ready||!n.$keycloak.authenticated?(b(),v("div",Fe,[Qe,d("button",{onClick:e[0]||(e[0]=(...s)=>n.$keycloak.login&&n.$keycloak.login(...s))},"Login")])):(b(),v("div",Ue,[c(J,null,{default:p(()=>[d("button",{onClick:e[1]||(e[1]=(...s)=>n.newTournament&&n.newTournament(...s))},"New Tournament"),c(i)]),_:1})]))])}var z=C(We,[["render",Je]]);const G=140,ae=26,h=44,Me=1e3,je=1e3,K=1,O="#071425",ie="#ba411f",ze="#863845",Z="#D5D5D7",Ke="#EBEBEF",Ze="#FFC300",Ye="#384863";var $;let se={UpperBackground:Z,LowerBackground:Ke,GameIDBackgroundColor:ze,LosersGameIdBackgroundColor:Ye,PendingGameIdBackgroundColor:O};function le(n,e,t,o,r){n.beginPath(),n.moveTo(e,t),n.lineTo(e+(o-e)/2,t),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(e+(o-e)/2,t),n.lineTo(e+(o-e)/2,r),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(e+(o-e)/2,r),n.lineTo(o,r),n.closePath(),n.stroke()}function Xe(){return document.createElement("canvas").getContext("2d"),(window.devicePixelRatio||1)/1}const ce=new FontFace("material-icons","url(https://fonts.gstatic.com/s/materialicons/v48/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2)");document.fonts.add(ce);class ue{constructor(e,t){l(this,"x");l(this,"y");l(this,"selection");l(this,"orientation");l(this,"data");l(this,"tournamentId");l(this,"rootNode");l(this,"canvas");l(this,"winnersHeaderButtons");l(this,"losersHeaderButtons");l(this,"drawcenter");l(this,"ratio");l(this,"Preferences");l(this,"width");l(this,"height");l(this,"isFullScreen");if(this.data=e,this.isFullScreen=!1,t!=null?this.Preferences=new de(t):this.Preferences=xe(),this.x=0,this.y=0,this.selection=null,this.orientation=K,this.canvas=document.getElementById("bracket-canvas"),this.winnersHeaderButtons=document.getElementById("winners-header-buttons"),this.losersHeaderButtons=document.getElementById("losers-header-buttons"),this.drawcenter=0,this.ratio=0,e!=null){let r=e.bracket;var o=new N(this,e,r,r.nodes[r.rootNodeId]);this.rootNode=o,this.tournamentId=e.id}else this.tournamentId=0;this.width=0,this.height=0,this.canvas.addEventListener("mousedown",this.bracketMousedownHandler.bind(this),!1),document.addEventListener("keydown",this.keypressHandler.bind(this),!1)}getMousePos(e,t){var o=e.getBoundingClientRect();return{x:t.clientX-o.left,y:t.clientY-o.top}}keypressHandler(e){if(this.selection!=null){var t=0;if(e.code=="Digit1"?t=1:e.code=="Digit2"&&(t=2),t!=0){var o="/tournaments/"+this.tournamentId+"/games/"+this.selection.node.Id+"/winner/"+t;let r=this;k.post(o).then(function(a){var i=document.getElementById("nav-tournament-state");i!=null&&(i.innerHTML="Status: "+r.data.tournamentState),r.update(a.data)}).catch(function(a){console.log(a)}).then(function(){})}else if(e.code=="KeyU"){let r=this;var o="/tournaments/"+r.tournamentId+"/games/"+this.selection.node.Id+"/winner";k.delete(o).then(function(i){r.update(i.data)}).catch(function(i){console.log(i)}).then(function(){})}}}bracketMousedownHandler(e){var t=document.getElementById("bracket-canvas");document.getElementById("fullscreen_div");var o=this.getMousePos(t,e);if(""+o.x+o.y,this.rootNode!=null&&(this.selection=this.rootNode.IntersectGame(o.x,o.y)),this.selection!=null){this.render();return}let r=o;r.x-=window.scrollX,r.y-=window.scrollY}resize(e,t,o){let r=this.calcSize(e.bracket,t);o.width=r.width,o.height=r.height,o.style.width=r.width+"px",o.style.height=r.height+"px",this.width=r.width,this.height=r.height,this.ratio=Xe(),console.log("*******size= "+JSON.stringify(r)+", ratio = "+this.ratio)}setup(){let e=this.canvas;e!=null&&(e.getContext("2d"),ce.load().then(()=>{}).catch(console.error))}render(){let e=this.data,t=this.rootNode,o=this.canvas,r;o!=null&&(r=o.getContext("2d"),r.clearRect(0,0,o.width,o.height),r.fillStyle=f(this.Preferences.GetBGColor()),r.fillRect(0,0,o.width,o.height),this.orientation==K&&this.renderRightToLeft(e,t,o))}renderRightToLeft(e,t,o){let r=o.getContext("2d");var a=this.width;let i=this.height/2-100;t&&(i=t.span.upper+22),r.strokeStyle=f(this.Preferences.GetGameBorderColor()),r.lineWidth=1,r.beginPath(),r.moveTo(a-(G+10),i),r.lineTo(a,i),r.closePath(),r.stroke(),r.strokeStyle=f(ie),r.fillStyle=f(ie),r.textAlign="center",r.font="18px Arial";var s=this.getWinner();r.strokeText(s,a-(G+10)/2,i-8);let u={leftMostWinner:1e3,winners:new Map,losers:new Map};return this.rootNode!=null&&this.rootNode.renderRightToLeft(r,a-(G+(G-10)),i-h/2,1,t.degree,this.selection,u),u}getWinner(){if(this.data!=null){if(this.data.bracket.root&&this.data.bracket.root.state.result!=null){var e=this.data.bracket.root.state.result.winningParticipant;if(e>0){var t=this.data.participants[e];if(t!=null)return t.name}}return"<TBD>"}}calcSize(e,t){if(t){console.log("losersDepth = "+e.depth);let o=(e.depth+2)*G+(e.depth+1)*ae,r=e.root.span.upper+e.root.span.lower+100;return{width:o,height:r}}return{width:je,height:Me}}resizeCanvasToDisplaySize(e){const t=e.clientWidth,o=e.clientHeight;return e.width!==t||e.height!==o?(e.width=t,e.height=o,!0):!1}update(e){if(this.tournamentId=e.id,this.data=e,this.data.bracket.rootNodeId!=0){let o=this.data.bracket;var t=new N(this,e,o,o.nodes[o.rootNodeId]);this.rootNode=t,this.resize(e,t,this.canvas),this.render()}else console.log("No rootNodeID")}}class N{constructor(e,t,o,r){l(this,"TheBracket");l(this,"tournament");l(this,"bracket");l(this,"orientation");l(this,"left");l(this,"right");l(this,"game");l(this,"participant1");l(this,"participant2");l(this,"dropGame1");l(this,"dropGame2");l(this,"x");l(this,"y");l(this,"span");l(this,"gridSpan");l(this,"width");l(this,"selection");l(this,"upperBGColor");l(this,"lowerBGColor");l(this,"connectorColor");l(this,"gameIdBGColor");l(this,"losersGameIdBGColor");l(this,"pendingGameIdBGColor");l(this,"Id");l(this,"participant");l(this,"dropGame");l(this,"isLosersSide");l(this,"subtype");if(this.TheBracket=e,this.tournament=t,this.bracket=o,this.game=r,this.selection=0,this.orientation=K,this.participant1=-1,this.participant2=-1,this.dropGame1=0,this.dropGame2=0,this.x=0,this.y=0,this.left=null,this.right=null,this.span=r.span,this.gridSpan=r.gridSpan,this.width=G,this.upperBGColor=f(e.Preferences.GetSlot1BGColor()),this.lowerBGColor=f(e.Preferences.GetSlot2BGColor()),this.connectorColor=f(e.Preferences.GetConnectorColor()),this.gameIdBGColor=f(e.Preferences.GetGameWinnersBackgroundColor()),this.losersGameIdBGColor=f(e.Preferences.GetGameLosersBackgroundColor()),this.pendingGameIdBGColor=f(O),this.Id=r.id,this.participant=r.participant,this.dropGame=r.drop,this.subtype=r.nodeSubType,r.tier==2?this.isLosersSide=!0:this.isLosersSide=!1,!(r.left.id==0&&r.right.id==0)){if(r.left.id!=0){var a=this.bracket.nodes[r.left.id],i=a.nodeType;i==1?this.participant1=a.participant:i==2?(this.left=new N(this.TheBracket,this.tournament,this.bracket,a),a!=null&&(this.participant1=a.participant)):i==3&&(this.dropGame1=a.drop,this.participant1=a.participant,this.left=null)}if(r.right.id!=0){var a=this.bracket.nodes[r.right.id],i=a.nodeType;i==1?this.participant2=a.participant:i==2?(this.right=new N(this.TheBracket,this.tournament,this.bracket,a),a!=null&&(this.participant2=a.participant)):i==3&&(this.dropGame2=a.drop,this.participant2=a.participant,this.right=null)}}}playerName(e){var t=this.tournament.participants[e];return t!=null?t.name:"BUY"}frameBox(e,t,o,r,a,i,s,u){e.textAlign="Left",e.lineWidth=1,e.clearRect(t,o,r,h),e.strokeRect(t,o,r,h),e.strokeStyle=this.TheBracket.Preferences.GetGameBorderColor(),e.fillStyle=i.alpha(a),u?(e.strokeRect(t+24,o,r-24,h),e.fillRect(t+25,o+1,r-26,h/2-2),e.fillStyle=s.alpha(a),e.fillRect(t+25,o+1+h/2,r-26,h/2-2)):(e.strokeRect(t,o,r-24,h),e.fillRect(t+1,o+1,r-26,h/2-2),e.fillStyle=s.alpha(a),e.fillRect(t+1,o+1+h/2,r-26,h/2-2))}fillBox(e,t,o,r,a,i,s){e.fillStyle=i.alpha(a),s?(e.fillRect(t+1,o+1,22,h-2),e.beginPath(),e.moveTo(t+24,o+h/2),e.lineTo(t+r,o+h/2)):(e.fillRect(t+r-23,o+1,22,h-2),e.beginPath(),e.moveTo(t,o+h/2),e.lineTo(t+r-24,o+h/2)),e.closePath(),e.stroke(),e.lineWidth=1}highlight(e,t,o,r,a){e.strokeStyle=f(Ze),e.lineWidth=3,a?(e.strokeRect(t+24,o,r-24,h),e.strokeRect(t,o,r,h)):(e.strokeRect(t,o,r-24,h),e.strokeRect(t,o,r,h)),e.lineWidth=1}calcTextColor(e){return f(O)}drawPlayerIndicator(e,t,o,r,a,i,s){e.font="14px Arial",e.fontWeight="bold",e.textAlign="center";let u="TBD";u=this.getDisplay(a);var m;if(u.startsWith(">>")===!0?m=f(O):m=this.TheBracket.Preferences.GetGameFontColor(),e.strokeStyle=m,e.fillStyle=m,m!=null){s!=0&&(s==a?(e.font="18px Arial",e.fontWeight="bold",m=this.TheBracket.Preferences.GetGameWinnersFontColor()):(e.fontWeight="lighter",e.font="13px Arial",m=this.TheBracket.Preferences.GetGameFontColor()),e.strokeStyle=m,e.fillStyle=m);var y=0;a==1?y=h/2-5:y=h-5,a==2&&this.game.nodeType==4&&this.game.challengerUpOne&&(u=u+" ++"),u=="BUY"?(e.fillStyle="blue",e.font="24px material-icons",e.fillText("stars",t+(r-24)/2,o+y+2)):e.fillText(u,t+(r-24)/2,o+y),e.fontWeight="normal"}}drawID(e,t,o,r,a){e.textAlign="center",e.font="15px Arial",e.fontWeight="bold",a?e.strokeText(this.Id,t+12,o+(h/2+6)):e.strokeText(this.Id,t+r-12,o+(h/2+6))}renderGame(e){let t=e.height,o=e.width,r=e.getContext("2d");r.strokeStyle=f("black"),r.fillStyle=f("black");var a=1,i=1;this.game.state.result!=null&&(r.strokeStyle=f("black"),r.fillStyle=f("black"),a=.6,i=1),this.frameGame(r,t,o,a);var s=0;this.game.state.result!=null&&(s=this.game.state.result.winningSlot),this.renderPlayerIndicator(r,t,o,1,s),this.renderPlayerIndicator(r,t,o,2,s),r.strokeStyle=f("black").alpha(a),this.game.state.result!=null&&(r.strokeStyle=f("black").brighten(i)),this.renderGameId(r,o,!1)}renderGameId(e,t,o){e.textAlign="center",e.font="16px Arial",o?e.strokeText(this.Id,12,h/2+6):e.strokeText(this.Id,t-12,h/2+6)}renderPlayerIndicator(e,t,o,r,a){e.font="14px Arial",e.textAlign="center";let i="TBD";i=this.getDisplay(r);var s;if(s=f("black"),e.strokeStyle=s,e.fillStyle=s,s!=null){a!=0&&(a==r?(e.font="17px Arial",s=this.TheBracket.Preferences.GetGameWinnersFontColor()):(e.font="12px Arial",s=s.alpha(.7)),e.strokeStyle=s,e.fillStyle=s);var u=0;r==1?u=t/2-5:u=t-5,e.strokeText(i,(o-24)/2,u)}}frameGame(e,t,o,r){e.textAlign="Left",e.lineWidth=1;var a=f(this.TheBracket.Preferences.GetGameBorderColor());e.strokeStyle=f(a),e.clearRect(0,0,o,t),e.strokeRect(0,0,o,t),e.strokeRect(0,0,o-24,t);var i=f(this.TheBracket.Preferences.GetSlot1BGColor());e.fillStyle=i,e.fillRect(1,1,o-26,t/2-2);var s=f(this.TheBracket.Preferences.GetSlot2BGColor());e.fillStyle=s,e.fillRect(1,1+t/2,o-26,t/2-2);var u;this.isLosersSide?u=f(se.LosersGameIdBackgroundColor):u=f(se.GameIDBackgroundColor),e.fillStyle=u.alpha(r),e.fillRect(o-23,1,22,t-2),e.beginPath(),e.moveTo(0,t/2),e.lineTo(o-24,t/2),e.closePath(),e.stroke()}renderRightToLeft(e,t,o,r,a,i,s){var u=this.width;let m=r;var y=ae,g=t-y/2;let T={left:t-y/2,width:u+y,level:m};this.isLosersSide?s.losers.has(m)||s.losers.set(m,T):(g<s.leftMostWinner&&(s.leftMostWinner=T),s.winners.has(m)||s.winners.set(m,T)),e.strokeStyle=f(this.TheBracket.Preferences.GetGameBorderColor());var P=1,E=1;this.game.state.result!=null&&(P=.6,E=1),this.x=t,this.y=o,this.frameBox(e,t,o,u,P,this.upperBGColor,this.lowerBGColor,!1);var A;this.isLosersSide?A=this.losersGameIdBGColor:A=this.gameIdBGColor,this.fillBox(e,t,o,u,P,A,!1),i!=null&&i.node.Id==this.Id&&this.highlight(e,t,o,u,!1);var D=0;this.game.state.result!=null&&(D=this.game.state.result.winningSlot),this.drawPlayerIndicator(e,t,o,u,1,!1,D),this.drawPlayerIndicator(e,t,o,u,2,!1,D),this.game.state.result!=null?e.strokeStyle=f(Z):e.strokeStyle=f(Z),this.drawID(e,t,o,u,!1);let H=0,q=0;if(this.participant1,this.participant2,this.left){e.strokeStyle=this.connectorColor.brighten(E);var x=o-this.left.span.lower;le(e,t-y,x+h/2,t,o+h/4),H=this.left.renderRightToLeft(e,t-u-y,x,r+1,a,i,s)}if(this.right){e.strokeStyle=this.connectorColor.brighten(E);var ee=o+this.right.span.upper;le(e,t-y,ee+h/2,t,o+h/4*3),q=this.right.renderRightToLeft(e,t-u-y,ee,r+1,a,i,s)}return H==0&&q==0?1:Math.max(H,q)+1}getDisplay(e){if(e==1){if(this.isLosersSide){if(this.participant1!=0)return this.playerName(this.participant1);if(this.dropGame1!=0)return"L"+this.dropGame1}else if(this.participant1!=0)return this.playerName(this.participant1);return""}else if(this.isLosersSide){if(this.participant2!=0)return this.playerName(this.participant2);if(this.dropGame2!=0)return"L"+this.dropGame2}else if(this.participant2!=0)return this.playerName(this.participant2);return""}SetSelection(e){this.selection=e}IntersectGame(e,t){if(e>this.x&&e<this.x+this.width&&t>this.y&&t<this.y+h)return{node:this};if(this.right!=null){var o=this.right.IntersectGame(e,t);if(o!=null)return o}if(this.left!=null){var o=this.left.IntersectGame(e,t);if(o!=null)return o}return null}}function xe(){let n={"brackets.background-color":"#3C3D40","brackets.connector-color":"#FAF30B","brackets.game.border-color":"#97a872","brackets.game.font-color":"#863845","brackets.game.losers.background-color":"#384863","brackets.game.slot1.background-color":"#D5D5D7","brackets.game.slot1.font-color":"#272822","brackets.game.slot2.background-color":"#EBEBEF","brackets.game.slot2.font-color":"#272822","brackets.game.winners.background-color":"#863845","brackets.game.winners.font-color":"#57294b"};return new de(n)}class de{constructor(e){l(this,"prefs");this.prefs=e}GetBGColor(){return this.prefs["brackets.background-color"]}GetConnectorColor(){return this.prefs["brackets.connector-color"]}GetSlot1BGColor(){return this.prefs["brackets.game.slot1.background-color"]}GetSlot2BGColor(){return this.prefs["brackets.game.slot2.background-color"]}GetGameWinnersFontColor(){return this.prefs["brackets.game.winners.font-color"]}GetGameBorderColor(){return this.prefs["brackets.game.border-color"]}GetGameWinnersBackgroundColor(){return this.prefs["brackets.game.winners.background-color"]}GetGameLosersBackgroundColor(){return this.prefs["brackets.game.losers.background-color"]}GetGameFontColor(){return this.prefs["brackets.game.font-color"]}Update(e){this.prefs=e}}const et=I({name:"Bracket",inject:["router"],props:{currentTab:String,tournamentId:Number},watch:{currentTab(n){n=="Bracket"&&this.activateTab()}},setup(){},data:function(){return{preferences:null,bracket:null,isLoading:!0,error:"",tournament:{id:0}}},mounted:function(){this.activateTab()},updated(){},methods:{createBracket(){let n=this,e="/tournaments/"+n.tournamentId+"/generate";k.put(e).then(function(t){n.tournament=t.data,$=new ue(n.tournament,n.preferences),$.setup(),$.update(t.data)}).catch(function(t){n.error=t.toString(),console.log(t)}).then(function(){n.isLoading=!1})},activateTab(){let n=this.fetchPreferences(),e=this.fetchTournament();var t=this;Promise.all([n,e]).then(function(){t.tournament!=null?t.tournament.tournamentState!="Underway"||t.tournament.bracket.root==null?t.createBracket():($=new ue(t.tournament,t.preferences),$.setup(),$.update(t.tournament)):console.log("No Tournament")})},fetchPreferences(){let n=this,e="/preferences";return k.get(e).then(function(t){n.preferences=t.data}).catch(function(t){console.log(t)}).then(function(){})},fetchTournament(){let n=this,e="/tournaments/"+n.tournamentId;return k.get(e).then(function(t){n.tournament=t.data}).catch(function(t){n.error=t.toString(),console.log(t)}).then(function(){n.isLoading=!1})},Shuffle(){let n=this,e="/tournaments/"+n.tournamentId+"/randomize";return k.put(e).then(function(t){n.fetchTournament().then(function(){n.createBracket()})}).catch(function(t){n.error=t.toString(),console.log(t)}).then(function(){})},toggleFullscren(n){const e=n.target.parentNode.parentNode.parentNode;$q.fullscreen.toggle(e).then(()=>{}).catch(t=>{alert(t)})}},computed:{GamesRemaining(){return"?"}}}),tt=n=>(Q("data-v-50cda172"),n=n(),U(),n),nt=tt(()=>d("div",{id:"bracket-panel",class:"container"},[d("div",{id:"main-bracket-div"},[d("div",{id:"bracket-div",style:{position:"static"}},[d("canvas",{id:"bracket-canvas",style:{margin:"0px"}})])])],-1)),ot=[nt];function rt(n,e,t,o,r,a){return b(),v("div",null,ot)}var at=C(et,[["render",rt],["__scopeId","data-v-50cda172"]]);const it=I({name:"TournamentInfo",inject:["router"],props:{tournament:{type:Object},currentTab:String},watch:{currentTab(n){console.log("val = "+n),n=="Info"&&console.log("Info activated")}},data:function(){return{isLoading:!0,error:null,tournament:{id:0}}},updated(){},mounted:function(){},methods:{}}),st={class:"container"},lt={class:"q-pa-xs"},ct={class:"q-gutter-y-md column",style:{"max-width":"300px"}},ut={class:"self-center full-width no-outline",tabindex:"0"};function dt(n,e,t,o,r,a){return b(),v("div",st,[d("div",lt,[d("div",ct,[c(ne,{dense:!0,modelValue:n.tournament.name,"onUpdate:modelValue":e[0]||(e[0]=i=>n.tournament.name=i),label:"Name"},null,8,["modelValue"]),c(ne,{dense:!0,modelValue:n.tournament.status,"onUpdate:modelValue":e[1]||(e[1]=i=>n.tournament.status=i),label:"Status"},null,8,["modelValue"]),c(Te,{dense:!0,label:"Tournament Type","stack-label":""},{control:p(()=>[d("div",ut,w(n.tournament.typ==1?"Single Elim":"Double Elim"),1)]),_:1})])])])}var ht=C(it,[["render",dt]]);const he=n=>(Q("data-v-f3fa60a6"),n=n(),U(),n),pt={key:0},ft=he(()=>d("h1",null,"Loading ....",-1)),mt=[ft],gt={key:1,id:"q-app",style:{"min-height":"100vh"}},bt=S(" No more new players can be accepted at this point "),kt=he(()=>d("input",{type:"text",id:"participant_names",name:"names"},null,-1)),yt={class:"q-pa-md"},_t=I({name:"Participants",inject:["router"],data:function(){return{loading:!0,participants:[]}},watch:{currentTab(n){n=="Participants"&&console.log("Participants activated")}},props:{currentTab:String,tournamentId:Number},mounted(){this.fetchParticipants()},updated(){},methods:{fetchParticipants(){this.loading=!0;let n=this;if(n.tournamentId==0)return;console.log("cmp.tournamentId = "+JSON.stringify(n.tournamentId));let e="/tournaments/"+n.tournamentId+"/participants";k.get(e).then(function(t){console.log("response = "+JSON.stringify(t)),n.participants=t.data}).catch(function(t){console.log(t)}).then(function(){n.loading=!1})},AddPlayer(){var n=document.getElementById("participant_names");let e=n.value.split(",");var t=new Array;let o=this;for(let a of e)if(a&&a.trim().length>0){let s={name:a};t.push(s)}let r="/tournaments/"+o.tournamentId+"/participants";k.post(r,JSON.stringify(t)).then(function(a){console.log("response = "+JSON.stringify(a)),o.participants=a.data,o.showInfoBanner()}).catch(function(a){console.log(a),o.toggleErrorBanner()}).then(function(){})},deleteParticipant(n){console.log("props: "+JSON.stringify(n));let e=this,t="/tournaments/"+e.tournamentId+"/participants/"+n.row.participantNumber;k.delete(t).then(function(o){console.log("response = "+JSON.stringify(o)),e.participants=o.data}).catch(function(o){console.log(o)}).then(function(){})},setPaid(n){console.log("props: "+JSON.stringify(n));let e=this,t="/tournaments/"+e.tournamentId+"/participants/"+n.row.participantNumber+"/paid";k.post(t).then(function(o){console.log("response = "+JSON.stringify(o)),e.participants=o.data}).catch(function(o){console.log(o)}).then(function(){})},saveName(n){console.log("value = "+JSON.stringify(n));let e=this;const t=n.row;console.log("row = "+JSON.stringify(t));const o=t.participantNumber;let r="/tournaments/"+e.tournamentId+"/participants/"+o;const a=n.key;k.put(r,a).then(function(i){console.log("response = "+JSON.stringify(i))}).catch(function(i){console.log(i)}).then(function(){})},showInfoBanner(){console.log("showInfoBanner");var n=document.getElementById("info-banner"),n=document.getElementById("info-banner"),e=document.getElementById("error-banner");e!=null&&(e.style.display="block"),n!=null&&(n.innerHTML="Player(s) added",n.style.display="block",n.setAttribute("class","bg-positive text-white"),n.setAttribute("dense","true"));var t=document.getElementById("participant_names");t.value=""},toggleErrorBanner(){console.log("togglErrrorBanner");var n=document.getElementById("info-banner"),e=document.getElementById("error-banner");n!=null&&(n.style.display="none"),e!=null&&(e.style.display==="none"?(e.innerHTML="No more new players can be accepted at this point",e.setAttribute("class","bg-negative text-white"),e.setAttribute("dense","false"),e.style.display="block"):e.style.display="none")}}});var vt=I(F(W({},_t),{setup(n){const e=[{name:"participantNumber",required:!0,label:"Id",align:"left",field:o=>o.participantNumber,format:o=>`${o}`,sortable:!0},{name:"name",required:!0,label:"Name",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"paid",align:"center",label:"paid",field:"paidAmount",sortable:!0},{name:"actions",label:"Actions",field:"",align:"center"}],t=L({sortBy:"asc",descending:!1,page:1,rowsPerPage:12});return(o,r)=>{const a=_("q-banner"),i=_("q-btn"),s=_("q-td"),u=_("q-input"),m=_("q-popup-edit"),y=_("q-tr");return o.loading?(b(),v("div",pt,mt)):(b(),v("div",gt,[c(a,{dense:"",id:"info-banner",style:{display:"none"},class:"bg-positive text-white"}),c(a,{dense:"",id:"error-banner",style:{display:"none"},class:"bg-negative text-white"},{action:p(()=>[c(i,{flat:"",color:"white",label:"Dismiss",onClick:r[0]||(r[0]=g=>o.toggleErrorBanner())})]),default:p(()=>[bt]),_:1}),kt,c(i,{style:{display:"inline","margin-left":"6px"},onClick:o.AddPlayer,push:"",color:"primary",label:"Add"},null,8,["onClick"]),d("div",yt,[c(ye(Ie),{dense:!0,title:"Players","rows-per-page-option":10,rows:o.participants,pagination:t.value,"onUpdate:pagination":r[1]||(r[1]=g=>t.value=g),columns:e,"row-key":"name",id:"participant-table",ref:"tableRef"},{body:p(g=>[c(y,{props:g},{default:p(()=>[c(s,{key:"participantNumber",props:g},{default:p(()=>[S(w(g.row.participantNumber),1)]),_:2},1032,["props"]),c(s,{key:"name",props:g},{default:p(()=>[S(w(g.row.name)+" ",1),c(m,{buttons:"",modelValue:g.row.name,"onUpdate:modelValue":T=>g.row.name=T,"auto-save":""},{default:p(T=>[c(u,{modelValue:g.row.name,"onUpdate:modelValue":P=>g.row.name=P,onKeyup:_e(T.set,["enter"]),dense:"",autofocus:"",onBlur:P=>o.saveName(g)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),c(s,{key:"paid",props:g},{default:p(()=>[S(w(g.row.paid),1)]),_:2},1032,["props"]),c(s,null,{default:p(()=>[g.row.paidAmount==0?(b(),R(i,{key:0,dense:"",round:"",flat:"",color:"red",onClick:T=>o.setPaid(g),icon:"paid"},null,8,["onClick"])):(b(),R(i,{key:1,dense:"",round:"",flat:"",color:"green",icon:"paid"})),c(i,{dense:"",round:"",flat:"",color:"red",onClick:T=>o.deleteParticipant(g),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])])]))}}}));var wt=C(vt,[["__scopeId","data-v-f3fa60a6"]]);const Bt=I({name:"TournamentView",provides:{},components:{Bracket:at,TournamentInfo:ht,Participants:wt},data:function(){return{tournament:{id:0},tabs:["Info","Participants","Bracket"],currentTab:"Info",tab:L("Info"),error:null,loading:!0}},created(){let n=this;console.log("mount entr"),this.fetchTournament().then(function(){console.log("tournament: "+JSON.stringify(n.tournament))}),console.log("mount leave")},watch:{$route:"fetchTournament"},computed:{tournamentName(){if(this.tournament!=null)return this.tournament.name},playerCount(){if(this.tournament!=null)return Object.keys(this.tournament.participants).length},currentTabComponent(){return this.tab=="Info"?"TournamentInfo":this.tab=="Participants"?"Participants":this.tab=="Bracket"?"Bracket":"None"}},methods:{getTournamentId(){let n=this.$route.path.split("/");return n[n.length-1]},fetchTournament(){let n=this,e=n.getTournamentId(),t="/tournaments/"+e;return console.log("id = "+e),k.get(t).then(function(o){console.log("response = "+JSON.stringify(o)),n.getTournamentId()===e&&(n.tournament=o.data,n.loading=!1,n.$root.title=n.tournamentName,n.$root.players=n.playerCount)}).catch(function(o){n.error=o.toString(),console.log(o)}).then(function(){})},onBeforeTransition(n,e){console.log("newValue = "+n),console.log("oldValue = "+e)},openTab(n,e){var t,o,r;for(o=document.getElementsByClassName("tabcontent"),t=0;t<o.length;t++)o[t].style.display="none";for(r=document.getElementsByClassName("tablinks"),t=0;t<r.length;t++)r[t].className=r[t].className.replace(" active","");let a=document.getElementById(e);a!=null&&(a.style.display="block"),this.currentTab=e,n.currentTarget.className+=" active"}}}),Tt={key:0};function It(n,e,t,o,r,a){const i=_("TournamentInfo"),s=_("Participants"),u=_("Bracket");return b(),v("div",null,[n.loading?(b(),v("h1",Tt," Loading... ")):(b(),R(J,{key:1},{default:p(()=>[c(oe,null,{default:p(()=>[c(Se,{modelValue:n.tab,"onUpdate:modelValue":e[0]||(e[0]=m=>n.tab=m),class:"text-dark bg-secondary shadow-2",align:"justify","indicator-color":"dark"},{default:p(()=>[c(M,{name:"Info",icon:"edit_attributes",label:"Details"}),c(M,{name:"Participants",icon:"people",label:"Participants"}),c(M,{name:"Bracket",icon:"account_tree",label:"Bracket"})]),_:1},8,["modelValue"]),c(Ce),c(Pe,{"keep-alive":"",modelValue:n.tab,"onUpdate:modelValue":e[1]||(e[1]=m=>n.tab=m),onBeforeTransition:n.onBeforeTransition},{default:p(()=>[c(j,{name:"Info"},{default:p(()=>[c(i,{tournament:n.tournament,currentTab:n.tab},null,8,["tournament","currentTab"])]),_:1}),c(j,{name:"Participants"},{default:p(()=>[c(s,{tournamentId:n.tournament.id,currentTab:n.tab},null,8,["tournamentId","currentTab"])]),_:1}),c(j,{name:"Bracket"},{default:p(()=>[c(u,{tournamentId:n.tournament.id,currentTab:n.tab},null,8,["tournamentId","currentTab"])]),_:1})]),_:1},8,["modelValue","onBeforeTransition"])]),_:1})]),_:1}))])}var Y=C(Bt,[["render",It],["__scopeId","data-v-bdeb084a"]]),St="/BracketsLogo.png";const Ct=I({name:"App",inject:["keycloak"],data(){return{title:"",players:0}},components:{Home:z,TournamentView:Y},created(){console.log("App created",this.$keycloak)}}),Pt=d("img",{src:St},null,-1),Gt=S(" Brackets "),$t={class:"q-py-none q-my-0 q-px-sm row"},Nt={class:"col-4"},Lt={class:"col-4"};function Rt(n,e,t,o,r,a){const i=_("text-body-1"),s=_("router-view");return b(),R(Re,{view:"hHh lpR fFf"},{default:p(()=>[c(Le,{elevated:"",class:"bg-primary text-white","height-hint":"40"},{default:p(()=>[c(Ge,null,{default:p(()=>[c($e,null,{default:p(()=>[c(Ne,null,{default:p(()=>[Pt]),_:1}),Gt]),_:1})]),_:1}),d("div",$t,[d("div",Nt,[c(i,null,{default:p(()=>[S(w(n.title),1)]),_:1})]),d("div",Lt,[c(i,null,{default:p(()=>[S(" Players: "+w(n.players),1)]),_:1})])])]),_:1}),c(J,{style:{"padding-top":"10px","padding-bottom":"15px"}},{default:p(()=>[c(s)]),_:1})]),_:1})}var Ot=C(Ct,[["render",Rt]]);const X=n=>(Q("data-v-cb0d41d6"),n=n(),U(),n),Et={key:0},At=X(()=>d("h1",null,"Loading ...",-1)),Dt=[At],Ht={key:1},qt=X(()=>d("h6",{style:{"margin-block-end":"4px","margin-block-start":"4px"},"text-center":""}," Tournaments ",-1)),Vt={class:"row",style:{"margin-bottom":"8px"}},Wt={class:"col-2"},Ft={class:"col-2"},Qt=X(()=>d("thead",null,[d("tr",null,[d("th",null,"Id"),d("th",null,"Name"),d("th",null,"Status"),d("th",null,"Players")])],-1)),Ut=I({name:"TournamentList",inject:["router"],data(){return{loading:!0,tournaments:[{id:1,name:"blah"}],error:null,separator:L("vertical")}},mounted:function(){let n=this;this.fetchTournaments().then(function(){console.log("tournaments: "+JSON.stringify(n.tournaments)),console.log("ListMounted mounted")})},updated:function(){},methods:{clickHandler(n,e){let t=this;console.log("row = "+JSON.stringify(e));const o=e.id;t.$router.push({path:"/tournament/"+o})},createClickHandler(n){let e=this;return()=>{const[t]=n.getElementsByTagName("td"),o=t.innerHTML;console.log("clickHandler"+o),e.$router.push({path:"/tournament/"+o})}},fetchTournaments(){this.error=null,this.loading=!0;let n=this;return k.get("/tournaments").then(function(e){console.log("response = "+JSON.stringify(e)),n.tournaments=e.data}).catch(function(e){n.error=e.toString(),console.log(e)}).then(function(){n.loading=!1})},newTournament(){console.log("newTourament");let n=this;return k.post("/tournaments").then(function(e){console.log("response = "+JSON.stringify(e)),n.fetchTournaments().then(function(){}).catch(function(t){})}).catch(function(e){n.error=e.toString(),console.log(e)}).then(function(){})},GetStateString(n){if(n==1)return"NeedsDraw";if(n==2)return"Ready";if(n==3)return"Underway";if(n==4)return"Registration";if(n==5)return"Complete"}}}),Jt=I(F(W({},Ut),{setup(n){const e=[{name:"id",required:!0,label:"id",align:"left",field:o=>o.id,format:o=>`${o}`,sortable:!0},{name:"name",align:"center",label:"name",field:"name",sortable:!0},{name:"state",align:"center",label:"state",field:"tournamentState",sortable:!0},{name:"playerCcount",align:"center",label:"state",field:"playerCount",sortable:!0}],t=L({sortBy:"asc",descending:!1,page:1,rowsPerPage:12});return(o,r)=>{const a=_("dir");return o.loading?(b(),v("div",Et,Dt)):(b(),v("div",Ht,[qt,d("div",Vt,[d("div",Wt,[c(re,{onClick:o.$keycloak.logoutFn,push:"",color:"primary",label:"Logout"},null,8,["onClick"])]),d("div",Ft,[c(re,{onClick:o.newTournament,push:"",color:"primary",label:"New Touranment"},null,8,["onClick"])])]),c(oe,null,{default:p(()=>[c(a,{class:"q-pa-md"},{default:p(()=>[c(Oe,{id:"tournament_list",dense:!0,title:"Tournaments",rows:o.tournaments,columns:e,pagination:t.value,"onUpdate:pagination":r[0]||(r[0]=i=>t.value=i),onRowClick:o.clickHandler,"row-key":"id"},{default:p(()=>[Qt,d("tbody",null,[(b(!0),v(ve,null,we(o.tournaments,i=>(b(),v("tr",{key:i.id},[d("td",null,w(i.id),1),d("td",null,w(i.name),1),d("td",null,w(i.tournamentState),1),d("td",null,w(i.participantCount),1)]))),128))])]),_:1},8,["rows","pagination","onRowClick"])]),_:1})]),_:1})]))}}}));var Mt=C(Jt,[["__scopeId","data-v-cb0d41d6"]]);const pe=He({history:qe(),routes:[{path:"/",name:"Home",component:z,children:[{path:"",component:Mt},{path:"tournament/:id",component:Y}],meta:{isAuthenticated:!1}}]}),k=Ae.create({baseURL:"http://localhost:3000/api"});function jt(){k.interceptors.request.use(async n=>{const e=B.config.globalProperties.$keycloak.token;return n.headers={Authorization:"Bearer "+e},n},n=>{Promise.reject(n)})}const B=Be(Ot);B.use(pe);B.use(Ee,{plugins:{}});B.provide("router",pe);B.use(De,{init:{onLoad:"login-required",silentCheckSsoRedirectUri:window.location.origin+"/silent-check-sso.html"},config:{url:"http://localhost:8080/auth",clientId:"brackets-app",realm:"GoogleBrackets",onAuthRefreshSuccess:function(){console.log("AuthRefreshSuccess")}},onReady(n){console.log("Keycloak ready"),jt(),B.provide("keycloak",B.config.globalProperties.$keycloak),B.component("Home",z),B.component("TournamentView",Y),B.mount("#app")}});
